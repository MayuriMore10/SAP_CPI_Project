<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JMS Queues - SAP CPI Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css" />
</head>
<body class="light">
    <div class="layout">
        <aside class="sidebar">
            <div class="brand">Dashboard</div>
            <nav>
                <a href="/login">Login</a>
                <a href="/">Home</a>
                <a href="/show">Message Stores</a>
            </nav>
        </aside>
        <main class="content">
            <div class="container">
                <h1>JMS Queues</h1>
                <div class="card">
                    <h2>Overview</h2>
                    <p>JMS (Java Message Service) Queues in SAP Integration Suite provide asynchronous messaging capabilities. They enable reliable message delivery and decoupling between different parts of your integration landscape.</p>
                </div>
                <div class="actions">
                    <button id="btnLoadQueues">Load JMS Queues</button>
                    <button id="btnClear" class="ghost">Clear</button>
                </div>
                <div id="tableWrap" class="table-wrap"></div>
            </div>
        </main>
    </div>

    <script>
    const tableWrap = document.getElementById('tableWrap');
    function renderTable(items){
        if (!Array.isArray(items)) items = [];
        if (items.length === 0){ tableWrap.innerHTML = '<div class="muted">No data available</div>'; return; }
        const columns = Object.keys(items[0]);
        let html = '<table class="table"><thead><tr>' + columns.map(c=>`<th>${c}</th>`).join('') + '</tr></thead><tbody>';
        for (const row of items){
            html += '<tr>' + columns.map(c=>`<td>${escapeHtml(row[c])}</td>`).join('') + '</tr>';
        }
        html += '</tbody></table>';
        tableWrap.innerHTML = html;
    }
    function escapeHtml(v){
        if (v == null) return '';
        return String(v).replace(/[&<>"]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s]));
    }
    async function fetchAndRender(path){
        try {
            const res = await fetch(path);
            const data = await res.json();
            const items = normalize(data);
            renderTable(items);
        } catch (err) {
            tableWrap.innerHTML = `<div class="error">Error: ${err.message}</div>`;
        }
    }
    function normalize(resp){
        if (!resp || !resp.data) return [];
        const data = resp.data;
        if (data.d && Array.isArray(data.d.results)){
            return data.d.results.map(pick);
        }
        if (data.d && typeof data.d === 'object'){
            return [pick(data.d)];
        }
        return [];
    }
    function pick(obj){
        const keys = ['QueueName','BrokerName','State','MessageCount','Status','CreatedAt','LastModifiedAt','Description','Type'];
        const out = {};
        for (const k of keys){ if (k in obj) out[k] = obj[k]; }
        return out;
    }
    document.getElementById('btnLoadQueues').addEventListener('click', ()=> fetchAndRender('/api/queues/jms'));
    document.getElementById('btnClear').addEventListener('click', ()=> { tableWrap.innerHTML = ''; });
    </script>
</body>
</html>
